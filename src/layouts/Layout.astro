---
import { SITE, NAV_LINKS, COPYRIGHT } from "@/config";
import ThemeToggle from "@components/ThemeToggle";

interface Props {
  title?: string;
  description?: string;
  canonicalURL?: string;
}

const { title = SITE.title, description = SITE.description, canonicalURL } = Astro.props;
const pageTitle = title === SITE.title ? title : `${title} | ${SITE.title}`;

// Generate canonical URL: use provided canonicalURL or construct from current URL
const canonical = canonicalURL || new URL(Astro.url.pathname, SITE.baseUrl).href;
---

<!doctype html>
<html lang={SITE.locale}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="author" content={SITE.author} />
    <meta name="google-site-verification" content="twVFs_dUxCyldlt-Sif72GezMsXbI0wKJEVTBJ1A22g" />

    <link rel="canonical" href={canonical} />

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <title>{pageTitle}</title>

    <script is:inline>
      // Initialize theme before page renders to prevent flash
      (function() {
        const theme = localStorage.getItem('theme') || 'light';
        if (theme === 'dark') {
          document.documentElement.classList.add('dark');
        } else {
          document.documentElement.classList.remove('dark');
        }
      })();
    </script>
  </head>
  <body class="bg-white dark:bg-gray-900">
    <div class="min-h-screen flex flex-col">
      <header class="py-6 px-4 border-b border-gray-200 dark:border-gray-800">
        <nav class="max-w-4xl mx-auto flex justify-between items-center">
          <a href="/" class="text-2xl font-bold text-gray-900 dark:text-white">
            {SITE.title}
          </a>
          <div class="flex items-center gap-6">
            <ul class="flex gap-6">
              {NAV_LINKS.map(({ label, href }) => (
                <li>
                  <a
                    href={href}
                    class="text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors"
                  >
                    {label}
                  </a>
                </li>
              ))}
            </ul>
            <ThemeToggle client:load />
          </div>
        </nav>
      </header>

      <main class="flex-1">
        <slot />
      </main>

      <footer class="py-6 px-4 border-t border-gray-200 dark:border-gray-800">
        <div class="max-w-4xl mx-auto text-center text-gray-600 dark:text-gray-400 text-sm">
          <p class="mb-2">
            {COPYRIGHT.notice}
          </p>
          <p>
            Code:
            <a
              href="https://github.com/anudeepsamaiya/anudeepsamaiya.github.io/blob/master/LICENSE"
              target="_blank"
              rel="noopener noreferrer"
              class="text-blue-600 dark:text-blue-400 hover:underline mx-1"
            >
              MIT License
            </a>
            | Content:
            <a
              href="https://github.com/anudeepsamaiya/anudeepsamaiya.github.io/blob/master/LICENSE-CONTENT"
              target="_blank"
              rel="noopener noreferrer"
              class="text-blue-600 dark:text-blue-400 hover:underline mx-1"
            >
              CC BY 4.0
            </a>
          </p>
        </div>
      </footer>
    </div>
  </body>
</html>

<style is:global>
  @tailwind base;
  @tailwind components;
  @tailwind utilities;
</style>
